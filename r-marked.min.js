/**
 * r-marked.js - This is a web component based on x-tags/Brick for rendering Markdown content directly into a page.
 * @author R. S. Doiel, <rsdoiel@gmail.com>
 * copyright (c) 2014
 * All Rights Reserved.
 * @license Released under the BSD 2-Clause License.
 */
!function(){"use strict";function httpGET(url,callback,progress){var request;if(void 0!==window.XMLHttpRequest)request=new XMLHttpRequest;else if(void 0!==XDomainRequest)request=new XDomainRequest;else if(void 0!==window.ActiveXObject)try{request=new ActiveXObject("Msxml2.XMLHTTP")}catch(err1){try{request=new ActiveXObject("Microsoft.XMLHTTP")}catch(err2){throw err2}}return request?(void 0!==callback&&(request.onreadystatechange=function(){if(void 0!==progress)switch(request.readyState){case 0:progress("uninitialized",request);break;case 1:progress("loading",request);break;case 2:progress("loaded",request);break;case 3:progress("interactive",request);break;case 4:progress("complete",request),200===request.status?callback(null,request.responseText):callback({status:request.status,error:"http request failed"},request.responseText)}}),request.open("GET",url),request.send(),request):(void 0!==callback&&callback("Can't create request object"),!1)}function resolveURL(doc_url,href){var last_slash=doc_url.lastIndexOf("/");return-1===href.indexOf("://")?-1===last_slash?doc_url+"/"+href:doc_url.substring(0,last_slash)+"/"+href:href}function loadContent(elem,url){httpGET(url,function(err,data){return err?void console.error("ERROR",err):void(void 0===marked?elem.innerHTML="<pre>"+data+"</pre>":(marked.setOptions({gfm:elem.getAttribute("gfm"),tables:elem.getAttribute("tables"),breaks:elem.getAttribute("breaks"),pedantic:elem.getAttribute("pedantic"),sanitize:elem.getAttribute("sanitize"),smartLists:elem.getAttribute("smartLists"),smartypants:elem.getAttribute("smartypants")}),marked(data,function(err,content){err&&console.log(err),elem.innerHTML=content})))},function(status){xtag.fireEvent(elem,"progress",{bubbles:!0,cancelable:!0,detail:{state:status}})})}xtag.register("r-marked",{lifecycle:{created:function(){void 0!==this.href&&this.href&&loadContent(this,resolveURL(document.URL,this.href))},attributeChanged:function(){void 0!==this.href&&this.href&&loadContent(this,resolveURL(document.URL,this.href))}},accessors:{href:{attribute:{url:""}},gfm:{attribute:{bool:!0}},tables:{attribute:{bool:!0}},breaks:{attribute:{bool:!1}},pedantic:{attribute:{bool:!1}},sanitize:{attribute:{bool:!0}},smartLists:{attribute:{bool:!0}},smartypants:{attribute:{bool:!1}}}})}();